---
title: "DDoS Attack Mitigation"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*. When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file). The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
library(dplyr)
library(ggplot2)
library(readr)
```

Load the dataset.

```{r}
packets <- read_csv("~/p4sec/ddosm-p4/pcaps/ddos20m14/if3_attack_out.csv")
```

Add a column with the index of the packet.

```{r}
packets = packets %>% tibble::rowid_to_column("index")
```

Add a column with the number of the observation window.

```{r}
log2m = 14
m = 2^log2m
get_ow = function(index, m) ((index - 1) %/% m + 1)
packets = packets %>% mutate(ow = get_ow(index,m))
```

Convert the ip.id field from hexadecimal to decimal. 

```{r}
#packets %>% slice((767 * 2^14 + 1):(769 * 2^14)) %>% mutate(id=strtoi(id))
packets = packets %>% mutate(id=strtoi(id))
```


Note: check the DDoS Mitigation notebook, where I calculate the indices. 

```{r}
packets %>% filter(index >= 4194300) 
```

As we can see, the attack begins with the fifth packet of OW 257. 

Get stats for the first OW: histogram of addresses for each delta value. 

```{r}
packets %>% filter(ow == 258) %>% group_by(id) %>% summarize(sources=n_distinct(src))
```



